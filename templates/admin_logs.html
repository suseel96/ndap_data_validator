{% extends "base.html" %}

{% block content %}
  <h4 class="mb-3">Admin: Logs</h4>

  <form class="row g-3 align-items-end mb-3" method="get" action="/admin/logs">
    <div class="col-md-4">
      <label class="form-label">Filter by user</label>
      <input class="form-control" type="text" name="username" value="{{ filter_username | default('') }}" placeholder="Leave blank for all users" />
    </div>
    <div class="col-md-2">
      <button class="btn btn-primary" type="submit">Apply</button>
    </div>
  </form>

  <div class="card">
    <div class="card-body p-0">
      <div class="table-responsive" style="max-height: 70vh; overflow-y: auto;">
        <table class="table table-sm table-striped mb-0">
          <thead class="table-light">
            <tr>
              <th>Time</th>
              <th>User</th>
              <th>Filename</th>
              <th>Validation status</th>
              <th>Validation comments</th>
              <th>Upload status</th>
              <th>Upload key</th>
              <th>Upload comments</th>
              <th>Airflow DAG status</th>
              <th>Source code</th>
              <th>DAG Run ID</th>
            </tr>
          </thead>
          <tbody>
            {% if pipeline_logs %}
              {% for row in pipeline_logs %}
                <tr>
                  <td>{{ row.event_time or '' }}</td>
                  <td>{{ row.username or '' }}</td>
                  <td>{{ row.filename or '' }}</td>
                  <td>{{ row.validation_status or 'Not run' }}</td>
                  <td>{{ row.validation_comments or '' }}</td>
                  <td>{{ row.upload_status or '' }}</td>
                  <td><code>{{ row.upload_key or '' }}</code></td>
                  <td>{{ row.upload_comments or '' }}</td>
                  <td>{{ row.airflow_status or 'Not triggered' }}</td>
                  <td>{{ row.source_code or 'N/A' }}</td>
                  <td><code>{{ row.dag_run_id or '' }}</code></td>
                </tr>
              {% endfor %}
            {% else %}
              <tr>
                <td colspan="11" class="text-center text-muted py-3">No log entries found.</td>
              </tr>
            {% endif %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
{% endblock %}

