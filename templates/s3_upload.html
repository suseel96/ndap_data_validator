{% extends "base.html" %}

{% block content %}
  <h4 class="mb-3">Step 4: Upload to AWS S3 {% if file_name %}<span class="text-muted">&mdash; {{ file_name }} ({{ record_count }} records)</span>{% endif %}</h4>
  {% if error %}
    <div class="alert alert-danger">{{ error }}</div>
    {% if trace %}<pre class="small">{{ trace }}</pre>{% endif %}
  {% endif %}
  {% if not settings_ready %}
    <div class="alert alert-warning">
      Step 4 is disabled until required settings are configured. Missing: {{ ', '.join(missing_settings) }}.
      <a href="/admin/settings" class="alert-link">Open Settings</a>
    </div>
  {% endif %}
  <form method="post" action="/upload" class="mt-3">
    <input type="hidden" name="token" value="{{ token }}" />
    <input type="hidden" name="columns" value="{{ '|||' . join(columns) }}" />
    <input type="hidden" name="time_date_only" value="" />

    {% for col in columns %}
      <input type="hidden" name="role_{{ col }}" value="{{ role_selection[col] }}" />
    {% endfor %}

    {% if not settings_ready %}<fieldset disabled>{% endif %}
    <div class="row g-3">
      <div class="col-md-6">
        <label class="form-label">File name including extension (to save in AWS S3)</label>
        <input class="form-control" type="text" name="object_key_name" value="{{ object_key_value }}" required />
      </div>
    </div>

    <hr class="my-4" />
    <div class="row g-3">
      <div class="col-md-6">
        <label class="form-label">S3 folder name</label>
        <input class="form-control" type="text" name="s3_folder_name" value="{{ s3_folder_value }}" placeholder="folder-name without /" required />
        <div class="form-text">The uploaded file will be saved inside this folder with a <code>/pending/</code> suffix.</div>
      </div>
    </div>

    {% if not settings_ready %}</fieldset>{% endif %}
    <button class="btn btn-primary mt-3" type="submit">Upload to S3</button>
  </form>
{% endblock %}
