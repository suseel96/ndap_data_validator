<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>{{ title or 'CSV Validator' }}</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="/static/style.css?v=4" />
  </head>
  <body>
    <header class="app-header py-2 px-3 border-bottom">
      <div class="container-fluid d-flex align-items-center justify-content-between">
        <h5 class="m-0 brand-title"><a href="/" class="brand-title-link">NDAP Data Validator</a></h5>
        <div>
          {% if request.session.get('username') %}
            <span class="me-2">Signed in as <strong>{{ request.session.get('username') }}</strong></span>
            {% if request.session.get('is_admin') %}
              <a class="btn btn-sm btn-outline-primary me-2" href="/admin/users">Admin Panel</a>
              <a class="btn btn-sm btn-outline-primary me-2" href="/admin/logs">Logs</a>
            {% endif %}
            <a class="btn btn-sm btn-outline-primary me-2" href="/">Upload New File</a>
            <a class="btn btn-sm btn-outline-primary me-2" href="/logs">My Logs</a>
            <a class="btn btn-sm btn-outline-primary me-2" href="/airflow">Airflow</a>
            <a class="btn btn-sm btn-primary" href="/logout">Logout</a>
          {% else %}
            {% if request.url.path != '/login' %}
              <a class="btn btn-sm btn-primary" href="/login">Login</a>
            {% endif %}
          {% endif %}
        </div>
      </div>
    </header>

    <div class="container-fluid app-shell">
      {% if show_stepper | default(true) %}
      <div class="pt-3 pb-2">
        <ol class="stepper stepper-horizontal list-unstyled d-flex gap-4 flex-wrap">
          {% set token_q = token if token is defined and token else None %}
          {% set qs = ('?token=' ~ token_q) if token_q else '' %}
          {% set completed = completed_steps | default([]) %}
          
          <li class="step {% if active_step == 1 %}active{% endif %} {% if 1 in completed %}completed{% endif %}">
            <a href="/" class="step-link">
              <div class="step-icon">1</div>
              <div class="step-title">Upload CSV and preview</div>
            </a>
          </li>
          <li class="step {% if active_step == 2 %}active{% endif %} {% if 2 in completed %}completed{% endif %} {% if 1 not in completed %}disabled{% endif %}">
            {% if 1 in completed %}
              <a href="/preview{{ qs }}" class="step-link">
                <div class="step-icon">2</div>
                <div class="step-title">Select column types</div>
              </a>
            {% else %}
              <span class="step-link disabled">
                <div class="step-icon">2</div>
                <div class="step-title">Select column types</div>
              </span>
            {% endif %}
          </li>
          <li class="step {% if active_step == 3 %}active{% endif %} {% if 3 in completed %}completed{% endif %} {% if 2 not in completed %}disabled{% endif %}">
            {% if 2 in completed %}
              <a href="/validate{{ qs }}" class="step-link">
                <div class="step-icon">3</div>
                <div class="step-title">Perform validations</div>
              </a>
            {% else %}
              <span class="step-link disabled">
                <div class="step-icon">3</div>
                <div class="step-title">Perform validations</div>
              </span>
            {% endif %}
          </li>
          <li class="step {% if active_step == 4 %}active{% endif %} {% if 4 in completed %}completed{% endif %} {% if 3 not in completed %}disabled{% endif %}">
            {% if 3 in completed %}
              <a href="/upload{{ qs }}" class="step-link">
                <div class="step-icon">4</div>
                <div class="step-title">Upload to AWS S3</div>
              </a>
            {% else %}
              <span class="step-link disabled">
                <div class="step-icon">4</div>
                <div class="step-title">Upload to AWS S3</div>
              </span>
            {% endif %}
          </li>
        </ol>
      </div>
      {% endif %}
      <div class="row">
        <main class="col-12 py-3">
          {% if error %}
            <div class="alert alert-danger">{{ error }}</div>
          {% endif %}
          {% if trace %}
            <pre class="small">{{ trace }}</pre>
          {% endif %}

          {% block content %}{% endblock %}
        </main>
      </div>
    </div>
  </body>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  </html>


